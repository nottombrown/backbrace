<!DOCTYPE html>  <html> <head>   <title>backbrace.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               backbrace.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Automatically binds <code>this</code> for all members of the class, so that you
don't have to call <code>_.bindAll</code> with a list of all of all of the
functions you've defined.  Usually best to call <code>@autoBind()</code> first
thing in <code>initialize</code>.  Thanks to <a href="http://sulf.me/2011/07/sick-of-backbone-js-_bindall/">this blog
post</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">autoBind =</span>
  <span class="nv">autoBind: </span><span class="o">-&gt;</span>
    <span class="nv">fns = </span><span class="nx">_</span><span class="p">.</span><span class="nx">functions</span><span class="p">(</span><span class="nx">@constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span>
    <span class="nv">prototype_fns = </span><span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span>
      <span class="p">[</span><span class="s1">&#39;autoBind&#39;</span><span class="p">,</span> <span class="s1">&#39;constructor&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">functions</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">),</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">functions</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">),</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">functions</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span>
      <span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Normally, we ignore functions defined in the Backbone classes.
However, <code>render()</code> should be bound because it's always
overridden (the implementation in View is just a useless
stub).</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="s1">&#39;render&#39;</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">fns</span><span class="p">,</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">prototype_fns</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
        <span class="err">@</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="err">@</span><span class="p">[</span><span class="nx">f</span><span class="p">],</span> <span class="err">@</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><code>autoBind</code> is available in the prototypes of all Backbone objects.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">autoBind</span><span class="p">)</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">autoBind</span><span class="p">)</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">autoBind</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Similar to <code>_.extend</code>, except that properties are not overridden.
Each property winds up with the value provided by the left-most
<code>source</code> (or the <code>destination</code> object itself).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">_.supplement = </span><span class="nf">(destination) -&gt;</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nf">(source) -&gt;</span>
    <span class="k">for</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">source</span>
      <span class="k">if</span> <span class="nx">val</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">and</span> <span class="o">!</span><span class="p">(</span><span class="nx">destination</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span><span class="o">?</span><span class="p">)</span>
        <span class="nx">destination</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
  <span class="k">return</span> <span class="nx">destination</span>

<span class="nb">window</span><span class="p">.</span><span class="nv">Backbrace = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Subset takes a <code>parent</code> collection and <code>filterfn</code>, a function that
maps models in the parent collection to booleans.  It implements the
same interface as the Backbone Collection class, and can be used
interchangeably.  <strong>Note that you must call <code>update()</code> if the
results of <code>filterfn</code> may have changed.  This will raise the <code>reset</code>
event.</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The implementation is loosely based on <a href="http://pastie.org/2286356">this
snippet</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">Subset</span>
  <span class="nv">models: </span><span class="p">[]</span>
  <span class="nv">constructor: </span><span class="nf">(options) -&gt;</span>
    <span class="vi">@parent = </span><span class="nx">options</span><span class="o">?</span><span class="p">.</span><span class="nx">parent</span>
    <span class="vi">@filterfn = </span><span class="nx">options</span><span class="o">?</span><span class="p">.</span><span class="nx">filterfn</span>
    <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span> <span class="o">or</span> <span class="nx">@parent</span> <span class="k">instanceof</span> <span class="nx">Backbrace</span><span class="p">.</span><span class="nx">Subset</span><span class="p">)</span>
      <span class="k">throw</span> <span class="s1">&#39;Required option: parent must be a Collection or Subset.&#39;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@filterfn</span> <span class="o">!=</span> <span class="s1">&#39;function&#39;</span>
      <span class="k">throw</span> <span class="s1">&#39;Required option: filterfn must be function mapping Model to boolean.&#39;</span>

    <span class="vi">@options = </span><span class="nx">options</span>
    <span class="k">delete</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">delete</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">filterfn</span>

    <span class="vi">@_bindings = </span><span class="p">{}</span>
    <span class="vi">@models = </span><span class="p">[]</span>

    <span class="nx">@_bind</span><span class="p">()</span>
    <span class="nx">@_reset</span><span class="p">()</span>
    <span class="nx">@initialize</span><span class="p">(</span><span class="nx">@options</span><span class="p">)</span>
  <span class="nv">_bind: </span><span class="o">-&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">switch</span> <span class="nx">ev</span>
        <span class="k">when</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span>
          <span class="k">if</span> <span class="nx">@filterfn</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
            <span class="nx">@_reset</span><span class="p">()</span>
            <span class="nx">@trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
        <span class="k">when</span> <span class="s1">&#39;error&#39;</span>
          <span class="k">if</span> <span class="nx">@filterfn</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
            <span class="nx">@trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
        <span class="k">when</span> <span class="s1">&#39;reset&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>This triggers the 'reset' event on the Subset and
refilters its contents.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">@update</span><span class="p">()</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This is a trick to catch all <code>change:xxx</code> events.  Custom
events are handled in <code>_onModelEvent</code>, not here.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nx">@getByCid</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
              <span class="k">if</span> <span class="o">!</span><span class="nx">@filterfn</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
                <span class="nx">@_reset</span><span class="p">()</span>
                <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
              <span class="k">else</span>
                <span class="nx">@trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The element is new.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="o">!</span><span class="nx">@getByCid</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">and</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterfn</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
              <span class="nx">@_reset</span><span class="p">()</span>
              <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
    <span class="vi">@_boundOnModelEvent = </span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">@_onModelEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
  <span class="nv">initialize: </span><span class="nf">(options) -&gt;</span>
  <span class="nv">_reset: </span><span class="o">-&gt;</span>
    <span class="vi">@model = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">model</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@models</span><span class="p">,</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">model</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="nx">@_bindings</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span>
    <span class="vi">@models = </span><span class="nx">@_models</span><span class="p">()</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@models</span><span class="p">,</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">@_bindings</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">@_onModelEvent</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
    <span class="vi">@length = </span><span class="nx">@models</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">_models: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">@parent</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span> <span class="nx">@filterfn</span><span class="p">)</span>
  <span class="nv">_onModelEvent: </span><span class="nf">(model, ev, params) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This monstronsity just filters out stock Backbone events, which
are handled in <code>_bind</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">switch</span> <span class="nx">ev</span>
      <span class="k">when</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span>
        <span class="k">return</span>
      <span class="k">else</span>
        <span class="k">if</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
          <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Custom events are forwarded if the model is a member of the
subset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@filterfn</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span>
      <span class="nx">@trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Causes the subset to be refiltered, and also raises the reset
event.  Should be called if the filter is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">update: </span><span class="o">-&gt;</span>
    <span class="nx">@_reset</span><span class="p">()</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">add: </span><span class="nf">(model, options) -&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">remove: </span><span class="nf">(model, options) -&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">get: </span><span class="nf">(id) -&gt;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">@models</span><span class="p">,</span> <span class="nf">(x) -&gt;</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">getByCid: </span><span class="nf">(cid) -&gt;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">@models</span><span class="p">,</span> <span class="nf">(x) -&gt;</span> <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">cid</span> <span class="o">==</span> <span class="p">(</span><span class="nx">cid</span><span class="p">.</span><span class="nx">cid</span> <span class="o">||</span> <span class="nx">cid</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nv">at: </span><span class="nf">(idx) -&gt;</span>
    <span class="k">return</span> <span class="nx">@models</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span>
  <span class="nv">sort: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">pluck: </span><span class="nf">(attr) -&gt;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">@models</span><span class="p">,</span> <span class="nf">(model) -&gt;</span> <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span>
  <span class="nv">reset: </span><span class="nf">(models, options) -&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">fetch: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@parent</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">create: </span><span class="nf">(model, options) -&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="nv">parse: </span><span class="nf">(resp) -&gt;</span>
    <span class="k">return</span> <span class="nx">resp</span>
  <span class="nv">chain: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">chain</span><span class="p">()</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">supplement</span><span class="p">(</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">Subset</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span>

<span class="nv">subsetMethods = </span><span class="p">[</span>
  <span class="s1">&#39;forEach&#39;</span><span class="p">,</span> <span class="s1">&#39;each&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;reduce&#39;</span><span class="p">,</span> <span class="s1">&#39;reduceRight&#39;</span><span class="p">,</span> <span class="s1">&#39;find&#39;</span><span class="p">,</span> <span class="s1">&#39;detect&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span>
  <span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;reject&#39;</span><span class="p">,</span> <span class="s1">&#39;every&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;some&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span><span class="p">,</span> <span class="s1">&#39;invoke&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
  <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sortBy&#39;</span><span class="p">,</span> <span class="s1">&#39;sortedIndex&#39;</span><span class="p">,</span> <span class="s1">&#39;toArray&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;rest&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">,</span>
  <span class="s1">&#39;without&#39;</span><span class="p">,</span> <span class="s1">&#39;indexOf&#39;</span><span class="p">,</span> <span class="s1">&#39;lastIndexOf&#39;</span><span class="p">,</span> <span class="s1">&#39;isEmpty&#39;</span> <span class="p">]</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">subsetMethods</span><span class="p">,</span> <span class="nf">(method_name) -&gt;</span>
  <span class="nx">Backbrace</span><span class="p">.</span><span class="nx">Subset</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">[</span><span class="nx">method_name</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="p">[</span><span class="nx">@models</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)))</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Binds to a collection (<code>parent</code>) and a list of model IDs
(<code>indices</code>); presents the interface of a collection containing the
models whose IDs are listed.  Can also bind to a property of a
model.  Changes to the property will trigger a <code>reset</code> event (via
<code>Subset.update()</code>) instead of add/remove events.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">IndexedSubset</span> <span class="k">extends</span> <span class="nx">Backbrace</span><span class="p">.</span><span class="nx">Subset</span>
  <span class="nv">constructor: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@autoBind</span><span class="p">()</span>
    <span class="vi">@parent = </span><span class="nx">options</span><span class="o">?</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">@parent</span><span class="o">?</span>
      <span class="k">throw</span> <span class="s1">&#39;Required option: parent&#39;</span>
    <span class="vi">@object = </span><span class="nx">options</span><span class="o">?</span><span class="p">.</span><span class="nx">object</span>
    <span class="vi">@property = </span><span class="nx">options</span><span class="o">?</span><span class="p">.</span><span class="nx">property</span>
    <span class="k">if</span> <span class="nx">@object</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@property</span><span class="o">?</span>
      <span class="vi">@indices = </span><span class="nx">@object</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">@property</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">@indices</span><span class="o">?</span>
        <span class="k">throw</span> <span class="s1">&#39;Object property is not present.&#39;</span>
      <span class="nx">@object</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;change:&#39;</span><span class="o">+</span><span class="nx">@property</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="vi">@indices = </span><span class="nx">@object</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">@property</span><span class="p">)</span>
        <span class="nx">@update</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="vi">@indices = </span><span class="nx">options</span><span class="o">?</span><span class="p">.</span><span class="nx">indices</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">@indices</span><span class="o">?</span>
        <span class="k">throw</span> <span class="s1">&#39;Required option: indices (if object, property not provided).&#39;</span>
    <span class="nx">@_bind</span><span class="p">()</span>
    <span class="nx">@_reset</span><span class="p">()</span>
  <span class="nv">filterfn: </span><span class="nf">(id) -&gt;</span>
    <span class="k">return</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">@indices</span>
  <span class="nv">_models: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@parent</span><span class="p">.</span><span class="nx">filter</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">id</span> <span class="k">in</span> <span class="nx">@indices</span>

<span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">TableView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="nv">collection: </span><span class="kc">null</span>
  <span class="nv">table_options: </span><span class="kc">null</span>
  <span class="nv">datatable: </span><span class="kc">null</span>
  <span class="nv">initialize: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@autoBind</span><span class="p">()</span>
    <span class="vi">@el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span>
    <span class="vi">@table_options = </span><span class="nx">options</span><span class="p">.</span><span class="nx">table_options</span>
    <span class="vi">@_table_rows = </span><span class="p">{}</span>

    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">@_addItem</span><span class="p">)</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="nx">@_removeItem</span><span class="p">)</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="nx">@repopulate</span><span class="p">)</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@_updateItem</span><span class="p">)</span>
  <span class="nv">render: </span><span class="o">-&gt;</span>
    <span class="vi">@datatable = </span><span class="nx">@el</span><span class="p">.</span><span class="nx">dataTable</span><span class="p">(</span><span class="nx">@table_options</span><span class="p">)</span>
    <span class="nx">@repopulate</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">repopulate: </span><span class="o">-&gt;</span>
    <span class="nx">@datatable</span><span class="p">.</span><span class="nx">fnClearTable</span><span class="p">()</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">@_addItem</span><span class="p">)</span>
  <span class="nv">_addItem: </span><span class="nf">(model) -&gt;</span>
    <span class="nv">row = </span><span class="nx">@datatable</span><span class="p">.</span><span class="nx">fnAddData</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">@_table_rows</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">row</span>
  <span class="nv">_removeItem: </span><span class="nf">(model) -&gt;</span>
    <span class="nv">row = </span><span class="nx">@_table_rows</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nx">row</span><span class="o">?</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="nx">@datatable</span><span class="p">.</span><span class="nx">fnDeleteRow</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span>
  <span class="nv">_updateItem: </span><span class="nf">(model) -&gt;</span>
    <span class="nv">row = </span><span class="nx">@_table_rows</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
    <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nx">row</span><span class="o">?</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="nx">@datatable</span><span class="p">.</span><span class="nx">fnUpdate</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(),</span> <span class="nx">row</span><span class="p">)</span>
    <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;rowchange&#39;</span><span class="p">,</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">model</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">@datatable</span><span class="p">.</span><span class="nx">fnGetNodes</span><span class="p">(</span><span class="nx">row</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Takes a <code>collection</code> and <code>itemView</code>, a class that implements the
Backbone View interface.  Renders an instance of <code>itemView</code> for each
item in the collection.</p>

<p>The child views' elements are all given the class <em>bb-list-item</em> so
that we can remove only those elements when clearing the list.</p>

<p>Whenever the collection changes, all child views will be destroyed
and recreated.  This isn't normally a problem, but might be if
you're doing something paritcularly fancy or have a huge list.</p>

<p>For legacy reasons, supports <code>filter</code>, an optional argument that
maps models to a boolean value indicating whether or not they should
be shown in the list.  The new way of doing this is with Subset.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">ListView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="nv">collection: </span><span class="kc">null</span>
  <span class="nv">itemView: </span><span class="kc">null</span>
  <span class="nv">filter: </span><span class="kc">null</span>
  <span class="nv">initialize: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@autoBind</span><span class="p">()</span>
    <span class="vi">@el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span>
    <span class="vi">@itemView = </span><span class="nx">options</span><span class="p">.</span><span class="nx">itemView</span>
    <span class="vi">@filter = </span><span class="nx">options</span><span class="p">.</span><span class="nx">filter</span> <span class="o">?</span> <span class="nf">(model) -&gt;</span> <span class="kc">true</span>

    <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">@filter</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span>
      <span class="k">throw</span> <span class="s1">&#39;filter: Must be function&#39;</span>
    <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nx">@collection</span><span class="p">)</span><span class="c1"># instanceof Backbone.Collection)</span>
      <span class="k">throw</span> <span class="s1">&#39;collection: Must be Backbone.Collection&#39;</span>

    <span class="vi">@collection = </span><span class="nx">options</span><span class="p">.</span><span class="nx">collection</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">@onCollectionAdd</span><span class="p">)</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="nx">@onCollectionReset</span><span class="p">)</span>
    <span class="nx">@collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@onCollectionChange</span><span class="p">)</span>
  <span class="nv">onCollectionAdd: </span><span class="nf">(model) -&gt;</span>
    <span class="nx">@render</span><span class="p">()</span>
  <span class="nv">onCollectionReset: </span><span class="o">-&gt;</span>
    <span class="nx">@render</span><span class="p">()</span>
  <span class="nv">onCollectionChange: </span><span class="o">-&gt;</span>
    <span class="nx">@render</span><span class="p">()</span>
  <span class="nv">render: </span><span class="o">-&gt;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.bb-list-item&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">@collection</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">@filter</span><span class="p">),</span> <span class="nx">@_addItem</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="nv">_addItem: </span><span class="nf">(model) -&gt;</span>
    <span class="nv">model.view = </span><span class="k">new</span> <span class="nx">@itemView</span><span class="p">({</span><span class="nv">model: </span><span class="nx">model</span><span class="p">})</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;bb-list-item&quot;</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Takes <code>views</code>, an object mapping tab IDs to view classes, and
<code>defaultView</code>, one of those tab IDs.  The <code>TabPaneView</code> will create
and render an instance of the corresponding view class.  When you
call <code>onTabChange</code> with a new tab ID, it will destroy the old markup
and do the same for the new view.</p>

<p>We use this to implement the body of a tabbed view.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">TabPaneView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="nv">initialize: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">@autoBind</span><span class="p">()</span>
    <span class="vi">@el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span>
    <span class="vi">@views = </span><span class="nx">options</span><span class="p">.</span><span class="nx">views</span>
    <span class="k">if</span> <span class="nx">options</span><span class="p">.</span><span class="nx">defaultView</span><span class="o">?</span>
      <span class="vi">@activeView = </span><span class="k">new</span> <span class="nx">@views</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">]()</span>
  <span class="nv">onTabChange: </span><span class="nf">(tabid) -&gt;</span>
    <span class="nx">@activeView</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
    <span class="vi">@activeView = </span><span class="k">new</span> <span class="nx">@views</span><span class="p">[</span><span class="nx">tabid</span><span class="p">]()</span>
    <span class="nx">@render</span><span class="p">()</span>
  <span class="nv">render: </span><span class="o">-&gt;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">append</span> <span class="nx">@activeView</span><span class="o">?</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span>
    <span class="k">return</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>This implements the actual UI element that lets you change which
child view a <code>TabPaneView</code> is displaying.  You will probably want to
modify this for your own purposes; this one depends heavily on
jQuery UI.  (If you're using jQuery UI want a tab bar that looks
just like the jQuery UI one, then you're golden.)</p>

<p><code>TabBarView</code> expects to be given a list element that contains a
<code>&lt;li&gt;</code> element for each tab.  The ID of the <code>&lt;li&gt;</code> element is used
as the corresponding tab ID.</p>

<p>Raises the <code>tabchange</code> event whenever a new selection is made.
Binding this to the <code>onTabChange</code> property of a <code>TabPaneView</code> will
make the two play nicely together.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbrace</span><span class="p">.</span><span class="nx">TabBarView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span>
  <span class="nv">initialize: </span><span class="o">-&gt;</span>
    <span class="nx">@autoBind</span><span class="p">()</span>
    <span class="nx">@_wrapElement</span><span class="p">()</span>
    <span class="vi">@tabs = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
      <span class="nx">@tabs</span><span class="p">[</span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
    <span class="vi">@activeTab = </span><span class="nx">@el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
    <span class="nx">@update</span><span class="p">()</span>
  <span class="nv">_wrapElement: </span><span class="o">-&gt;</span>
    <span class="nv">that = </span><span class="k">this</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all&#39;</span><span class="p">)</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;ui-state-default ui-corner-top&#39;</span><span class="p">)</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;ui-tabs ui-widget&quot; /&gt;&#39;</span><span class="p">)</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">each</span> <span class="nf">(i, el) -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;a&gt;&#39;</span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">)</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">click</span> <span class="o">-&gt;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">setTab</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
  <span class="nv">update: </span><span class="o">-&gt;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;ui-tabs-selected ui-state-active&#39;</span><span class="p">)</span>
    <span class="nx">@tabs</span><span class="p">[</span><span class="nx">@activeTab</span><span class="p">].</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;ui-tabs-selected ui-state-active&#39;</span><span class="p">)</span>
  <span class="nv">setTab: </span><span class="nf">(tabid) -&gt;</span>
    <span class="k">if</span> <span class="nx">@tabs</span><span class="p">[</span><span class="nx">tabid</span><span class="p">]</span><span class="o">?</span>
      <span class="vi">@activeTab = </span><span class="nx">tabid</span>
      <span class="nx">@update</span><span class="p">()</span>
      <span class="nx">@trigger</span><span class="p">(</span><span class="s1">&#39;tabchange&#39;</span><span class="p">,</span> <span class="nx">tabid</span><span class="p">)</span>
  <span class="nv">getTab: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@activeTab</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Given an instance of <code>TabBarView</code> and an instance of <code>TabPaneView</code>,
this utility function will construct a Backbone Router for you so
that each tab will have a corresponding hash URI.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">Backbrace.buildTabRouter = </span><span class="nf">(tabBarView, tabPaneView) -&gt;</span>
  <span class="nv">ext = </span><span class="p">{</span><span class="nv">routes: </span><span class="p">{}}</span>
  <span class="k">for</span> <span class="nx">tabid</span><span class="p">,</span> <span class="nx">tabview</span> <span class="k">of</span> <span class="nx">tabPaneView</span><span class="p">.</span><span class="nx">views</span>
    <span class="nx">ext</span><span class="p">.</span><span class="nx">routes</span><span class="p">[</span><span class="nx">tabid</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_tab_&#39;</span><span class="o">+</span><span class="nx">tabid</span>
    <span class="nx">do</span> <span class="nf">(tabid) -&gt;</span>
      <span class="nx">ext</span><span class="p">[</span><span class="s1">&#39;_tab_&#39;</span><span class="o">+</span><span class="nx">tabid</span><span class="p">]</span> <span class="o">=</span> <span class="o">-&gt;</span>
        <span class="nx">tabBarView</span><span class="p">.</span><span class="nx">setTab</span><span class="p">(</span><span class="nx">tabid</span><span class="p">)</span>
  <span class="nv">router = </span><span class="k">new</span> <span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span>
  <span class="k">return</span> <span class="nx">router</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 