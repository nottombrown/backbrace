(function(){var f,h=function(a,b){return function(){return a.apply(b,arguments)}},i=Array.prototype.indexOf||function(a){for(var b=0,d=this.length;b<d;b++)if(this[b]===a)return b;return-1},j=Object.prototype.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};f={autoBind:function(){var a,b;a=_.functions(this.constructor.prototype);b=_.without(["autoBind","constructor"].concat(_.functions(Backbone.Collection.prototype),
_.functions(Backbone.Model.prototype),_.functions(Backbone.View.prototype)),"render");return _.each(a,h(function(a){if(-1===_.indexOf(b,a))return this[a]=_.bind(this[a],this)},this))}};_.extend(Backbone.Collection.prototype,f);_.extend(Backbone.Model.prototype,f);_.extend(Backbone.View.prototype,f);window._.supplement=function(a){_.each(Array.prototype.slice.call(arguments,1),function(b){var d,c,e;e=[];for(d in b)c=b[d],e.push(0!==c&&null==a[d]?a[d]=c:void 0);return e});return a};window.Backbrace=
{};window.Backbrace.Subset=function(){function a(b){this.parent=null!=b?b.parent:void 0;this.filterfn=null!=b?b.filterfn:void 0;if(!(this.parent instanceof Backbone.Collection||this.parent instanceof Backbrace.Subset))throw"Required option: parent must be a Collection or Subset.";if("function"!==typeof this.filterfn)throw"Required option: filter must be function mapping Model to boolean.";this.options=b;delete this.options.parent;delete this.options.filterfn;this._bind();this._reset();this.initialize(this.options)}
a.prototype.models=[];a.prototype._bind=function(){var b;b=this;this.parent.bind("all",function(a){var c;c=arguments[1];switch(a){case "add":case "remove":if(b.filterfn(c))return b.trigger.apply(b,arguments),b._reset();break;case "refresh":return b._reset();default:if(0===a.indexOf("change")&&(b.getByCid(c)&&(b.filterfn(c)?b.trigger.apply(b,arguments):(b._reset(),b.trigger("remove",c,b))),!b.getByCid(c)&&b.filterfn(c)))return b._reset(),b.trigger("add",c,b)}});return this._boundOnModelEvent=_.bind(this._onModelEvent,
this)};a.prototype.initialize=function(){};a.prototype._reset=function(){this.model=this.parent.model;this.models=this._models();return this.length=this.models.length};a.prototype._models=function(){return _.filter(this.parent.models,this.filterfn)};a.prototype.update=function(){this._reset();this.trigger("reset",this);return this};a.prototype.add=function(b,a){this.parent.add(b,a);return this};a.prototype.remove=function(b,a){this.parent.remove(b,a);return this};a.prototype.get=function(b){return _.select(this.models,
function(a){return a.id===b})[0]};a.prototype.getByCid=function(b){return _.select(this.models,function(a){return a.cid===(b.cid||b)})[0]};a.prototype.at=function(b){return this.models[b]};a.prototype.sort=function(b){this.parent.sort(b);return this};a.prototype.pluck=function(b){return _.map(this.models,function(a){return a.get(b)})};a.prototype.reset=function(b,a){this.parent.reset(b,a);return this};a.prototype.fetch=function(b){this.parent.fetch(b);return this};a.prototype.create=function(b,a){return this.parent.create(b,
a)};a.prototype.parse=function(b){return b};a.prototype.chain=function(){return this.parent.chain()};return a}();_.supplement(Backbrace.Subset.prototype,Backbone.Collection.prototype);_.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,invoke,max,min,sortBy,sortedIndex,toArray,size,first,rest,last,without,indexOf,lastIndexOf,isEmpty".split(","),function(a){return Backbrace.Subset.prototype[a]=function(){return _[a].apply(_,[this.models].concat(_.toArray(arguments)))}});
window.Backbrace.IndexedSubset=function(){function a(b){this.autoBind();this.parent=null!=b?b.parent:void 0;if(!(this.parent instanceof Backbone.Collection||this.parent instanceof Backbrace.Subset))throw"Required option: parent must be a Collection or Subset.";this.indices=null!=b?b.indices:void 0;if(!this.indices){this.object=null!=b?b.object:void 0;this.property=null!=b?b.property:void 0;if(!this.object)throw"No indices given, but also no object";if(!this.property)throw"No indices given, but also no property";
this.indices=this.object.get(this.property);this.object.bind("change:"+this.property,this.update)}if(!this.indices)throw"No indices provided; or, object property not present";this.options=b;delete this.options.parent;delete this.options.object;delete this.options.property;delete this.options.indices;this._bind();this._reset();this.initialize(this.options)}a.prototype.models=[];a.prototype.indices=[];a.prototype.update=function(){if(this.object)this.indices=this.object.get(this.property);this._reset();
this.trigger("reset",this);return this};a.prototype._models=function(){var b;b=this;return _.filter(this.parent.models,function(a){var c;return c=a.id,0<=i.call(b.indices,c)})};return a}();_.supplement(Backbrace.IndexedSubset.prototype,Backbrace.Subset.prototype);window.Backbrace.Tableview=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.collection=null;a.prototype.table_options=null;a.prototype.datatable=null;a.prototype.initialize=function(b){this.autoBind();
this.el=$(this.el);this.table_options=b.table_options;this._table_rows={};this.collection.bind("add",this._addItem);this.collection.bind("remove",this._removeItem);this.collection.bind("reset",this.repopulate);return this.collection.bind("change",this._updateItem)};a.prototype.render=function(){this.datatable=this.el.dataTable(this.table_options);this.repopulate();return this};a.prototype.repopulate=function(){this.datatable.fnClearTable();return this.collection.each(this._addItem)};a.prototype._addItem=
function(b){var a;a=this.datatable.fnAddData(b.toJSON())[0];return this._table_rows[b.id]=a};a.prototype._removeItem=function(b){b=this._table_rows[b.id];return null==b?void 0:this.datatable.fnDeleteRow(b)};a.prototype._updateItem=function(b){var a;a=this._table_rows[b.id];if(null!=a)return this.datatable.fnUpdate(b.toJSON(),a),this.trigger("rowchange",a,b.id,this.datatable.fnGetNodes(a))};return a}();window.Backbrace.ListView=function(){function a(){a.__super__.constructor.apply(this,arguments)}
g(a,Backbone.View);a.prototype.collection=null;a.prototype.itemView=null;a.prototype.filter=null;a.prototype.initialize=function(b){var a;this.autoBind();this.el=$(this.el);this.itemView=b.itemView;this.filter=null!=(a=b.filter)?a:function(){return!0};if("function"!==typeof this.filter)throw"filter: Must be function";if(!this.collection)throw"collection: Must be Backbone.Collection";this.collection=b.collection;this.collection.bind("add",this.onCollectionAdd);this.collection.bind("reset",this.onCollectionReset);
return this.collection.bind("change",this.onCollectionChange)};a.prototype.onCollectionAdd=function(){return this.render()};a.prototype.onCollectionReset=function(){return this.render()};a.prototype.onCollectionChange=function(){return this.render()};a.prototype.render=function(){this.el.children(".bb-list-item").remove();_.each(this.collection.filter(this.filter),this._addItem);return this};a.prototype._addItem=function(a){a.view=new this.itemView({model:a});return this.el.append($(a.view.render().el).addClass("bb-list-item"))};
return a}();window.Backbrace.TabPaneView=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.initialize=function(a){this.autoBind();this.el=$("#tabpane");this.views=a.views;if(null!=a.defaultView)return this.activeView=new this.views[a.defaultView]({el:this.el})};a.prototype.onTabChange=function(a){this.activeView=new this.views[a]({el:this.el});return this.render()};a.prototype.render=function(){var a;this.el.empty();null!=(a=this.activeView)&&a.render();
return this};return a}();window.Backbrace.TabBarView=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.initialize=function(){var a,d,c,e;this.autoBind();this._wrapElement();this.tabs={};e=this.el.children("li");for(d=0,c=e.length;d<c;d++)a=e[d],this.tabs[a.id]=$(a);this.activeTab=this.el.children("li").first().attr("id");return this.update()};a.prototype._wrapElement=function(){var a;a=this;this.el=$(".tabs").addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");
this.el.children("li").addClass("ui-state-default ui-corner-top");this.el.wrap('<div class="ui-tabs ui-widget" />');return this.el.children("li").each(function(d,c){$(c).html("<a>"+$(c).text()+"</a>");return $(c).children("a").bind("click",function(){return a.setTab(c.id)})})};a.prototype.update=function(){this.el.children("li").removeClass("ui-tabs-selected ui-state-active");return this.tabs[this.activeTab].addClass("ui-tabs-selected ui-state-active")};a.prototype.setTab=function(a){if(null!=this.tabs[a])return this.activeTab=
a,this.update(),this.trigger("tabchange",a)};a.prototype.getTab=function(){return this.activeTab};return a}();window.Backbrace.buildTabRouter=function(a,b){var d,c,e,f;d={routes:{}};f=b.views;for(e in f)d.routes[e]="_tab_"+e,c=function(b){return function(){return a.setTab(b)}},d["_tab_"+e]=c(e);return new (Backbone.Router.extend(d))}}).call(this);
