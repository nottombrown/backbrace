(function(){var h,e=function(a,b){return function(){return a.apply(b,arguments)}},j=Object.prototype.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},i=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};h={autoBind:function(){var a,b;a=_.functions(this.constructor.prototype);b=_.without(["autoBind","constructor"].concat(_.functions(Backbone.Collection.prototype),
_.functions(Backbone.Model.prototype),_.functions(Backbone.View.prototype)),"render");return _.each(a,e(function(a){if(-1===_.indexOf(b,a))return this[a]=_.bind(this[a],this)},this))}};_.extend(Backbone.Collection.prototype,h);_.extend(Backbone.Model.prototype,h);_.extend(Backbone.View.prototype,h);window._.supplement=function(a){_.each(Array.prototype.slice.call(arguments,1),function(b){var c,d,f;f=[];for(c in b)d=b[c],f.push(0!==d&&null==a[c]?a[c]=d:void 0);return f});return a};window.Backbrace=
{};window.Backbrace.Subset=function(){function a(b){this.parent=null!=b?b.parent:void 0;this.filterfn=null!=b?b.filterfn:void 0;if(!(this.parent instanceof Backbone.Collection||this.parent instanceof Backbrace.Subset))throw"Required option: parent must be a Collection or Subset.";if("function"!==typeof this.filterfn)throw"Required option: filterfn must be function mapping Model to boolean.";this.options=b;delete this.options.parent;delete this.options.filterfn;this._bindings={};this.models=[];this._bind();
this._reset();this.initialize(this.options)}a.prototype.models=[];a.prototype._bind=function(){this.parent.bind("all",e(function(b,a){switch(b){case "add":case "remove":case "destroy":if(this.filterfn(a))return this._reset(),this.trigger.apply(this,arguments);break;case "error":if(this.filterfn(a))return this.trigger.apply(this,arguments);break;case "reset":return this.update();default:if(0===b.indexOf("change")&&(this.getByCid(a)&&(this.filterfn(a)?this.trigger.apply(this,arguments):(this._reset(),
this.trigger("remove",a,this))),!this.getByCid(a)&&this.filterfn(a)))return this._reset(),this.trigger("add",a,this)}},this));return this._boundOnModelEvent=_.bind(this._onModelEvent,this)};a.prototype.initialize=function(){};a.prototype._reset=function(){this.model=this.parent.model;_.each(this.models,e(function(b){return b.unbind("all",this._bindings[b.id])},this));this.models=this._models();_.each(this.models,e(function(b){return this._bindings[b.id]=b.bind("all",e(function(a){return this._onModelEvent(b,
a,arguments)},this))},this));return this.length=this.models.length};a.prototype._models=function(){return _.filter(this.parent.models,this.filterfn)};a.prototype._onModelEvent=function(b,a,d){switch(a){case "add":case "remove":case "destroy":case "reset":case "error":return;default:if(0===a.indexOf("change"))return}if(this.filterfn(b))return this.trigger.apply(this,d)};a.prototype.update=function(){this._reset();this.trigger("reset",this);return this};a.prototype.add=function(b,a){this.parent.add(b,
a);return this};a.prototype.remove=function(b,a){this.parent.remove(b,a);return this};a.prototype.get=function(b){return _.select(this.models,function(a){return a.id===b})[0]};a.prototype.getByCid=function(b){return _.select(this.models,function(a){return a.cid===(b.cid||b)})[0]};a.prototype.at=function(b){return this.models[b]};a.prototype.sort=function(b){this.parent.sort(b);return this};a.prototype.pluck=function(b){return _.map(this.models,function(a){return a.get(b)})};a.prototype.reset=function(a,
c){this.parent.reset(a,c);return this};a.prototype.fetch=function(a){this.parent.fetch(a);return this};a.prototype.create=function(a,c){return this.parent.create(a,c)};a.prototype.parse=function(a){return a};a.prototype.chain=function(){return this.parent.chain()};return a}();_.supplement(Backbrace.Subset.prototype,Backbone.Collection.prototype);_.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,invoke,max,min,sortBy,sortedIndex,toArray,size,first,rest,last,without,indexOf,lastIndexOf,isEmpty".split(","),
function(a){return Backbrace.Subset.prototype[a]=function(){return _[a].apply(_,[this.models].concat(_.toArray(arguments)))}});window.Backbrace.IndexedSubset=function(){function a(a){this.autoBind();this.parent=null!=a?a.parent:void 0;if(null==this.parent)throw"Required option: parent";this.object=null!=a?a.object:void 0;this.property=null!=a?a.property:void 0;if(null!=this.object&&null!=this.property){this.indices=this.object.get(this.property);if(null==this.indices)throw"Object property is not present.";
this.object.bind("change:"+this.property,e(function(){this.indices=this.object.get(this.property);return this.update()},this))}else if(this.indices=null!=a?a.indices:void 0,null==this.indices)throw"Required option: indices (if object, property not provided).";this._bindings={};this.models=[];this._bind();this._reset();this.initialize(this.options)}g(a,Backbrace.Subset);a.prototype.filterfn=function(a){var c;return c=a.id,0<=i.call(this.indices,c)};a.prototype._models=function(){return this.parent.filter(e(function(a){var c;
return c=a.id,0<=i.call(this.indices,c)},this))};return a}();window.Backbrace.TableView=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.collection=null;a.prototype.table_options=null;a.prototype.datatable=null;a.prototype.initialize=function(a){this.autoBind();this.el=$(this.el);this.table_options=a.table_options;this._table_rows={};this.collection.bind("add",this._addItem);this.collection.bind("remove",this._removeItem);this.collection.bind("reset",
this.repopulate);return this.collection.bind("change",this._updateItem)};a.prototype.render=function(){this.datatable=this.el.dataTable(this.table_options);this.repopulate();return this};a.prototype.repopulate=function(){this.datatable.fnClearTable();return this.collection.each(this._addItem)};a.prototype._addItem=function(a){var c;c=this.datatable.fnAddData(a.toJSON())[0];return this._table_rows[a.id]=c};a.prototype._removeItem=function(a){a=this._table_rows[a.id];return null==a?void 0:this.datatable.fnDeleteRow(a)};
a.prototype._updateItem=function(a){var c;c=this._table_rows[a.id];if(null!=c)return this.datatable.fnUpdate(a.toJSON(),c),this.trigger("rowchange",c,a.id,this.datatable.fnGetNodes(c))};return a}();window.Backbrace.ListView=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.collection=null;a.prototype.itemView=null;a.prototype.filter=null;a.prototype.itemClass="bb-list-item";a.prototype.initialize=function(a){var c;this.autoBind();this.el=$(this.el);
this.itemView=a.itemView;this.filter=null!=(c=a.filter)?c:function(){return!0};if(null!=a.itemClass)this.itemClass=a.itemClass;if("function"!==typeof this.filter)throw"filter: Must be function";if(!this.collection)throw"collection: Must be Backbone.Collection";this.collection=a.collection;this.collection.bind("add",this.onCollectionAdd);this.collection.bind("remove",this.onCollectionRemove);this.collection.bind("reset",this.onCollectionReset);return this.collection.bind("change",this.onCollectionChange)};
a.prototype.onCollectionAdd=function(){return this.render()};a.prototype.onCollectionRemove=function(){return this.render()};a.prototype.onCollectionReset=function(){return this.render()};a.prototype.onCollectionChange=function(){return this.render()};a.prototype.render=function(){this.el.children("."+this.itemClass).remove();_.each(this.collection.filter(this.filter),this._addItem);return this};a.prototype._addItem=function(a){a.view=new this.itemView({model:a});return this.el.append($(a.view.render().el).addClass(this.itemClass))};
return a}();window.Backbrace.TabPaneView=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.initialize=function(a){this.autoBind();this.el=$(this.el);this.views=a.views;this.activeView=null;if(null!=a.defaultView)return this.onTabChange(a.defaultView)};a.prototype.onTabChange=function(a){var c;null!=(c=this.activeView)&&c.remove();this.activeView=new this.views[a];return this.render()};a.prototype.render=function(){var a;this.el.append(null!=(a=this.activeView)?
a.render().el:void 0);return this};return a}();window.Backbrace.TabBarView=function(){function a(){a.__super__.constructor.apply(this,arguments)}g(a,Backbone.View);a.prototype.initialize=function(){var a,c,d,f;this.autoBind();this._wrapElement();this.tabs={};f=this.el.children("li");for(c=0,d=f.length;c<d;c++)a=f[c],this.tabs[a.id]=$(a);this.activeTab=this.el.children("li").first().attr("id");return this.update()};a.prototype._wrapElement=function(){var a;a=this;this.el.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");
this.el.children("li").addClass("ui-state-default ui-corner-top");this.el.wrap('<div class="ui-tabs ui-widget" />');return this.el.children("li").each(function(c,d){$(d).html("<a>"+$(d).text()+"</a>");return $(d).children("a").click(function(){return a.setTab(d.id)})})};a.prototype.update=function(){this.el.children("li").removeClass("ui-tabs-selected ui-state-active");return this.tabs[this.activeTab].addClass("ui-tabs-selected ui-state-active")};a.prototype.setTab=function(a){if(null!=this.tabs[a])return this.activeTab=
a,this.update(),this.trigger("tabchange",a)};a.prototype.getTab=function(){return this.activeTab};return a}();window.Backbrace.buildTabRouter=function(a,b){var c,d,f,e;c={routes:{}};e=b.views;f=function(b){return c["_tab_"+b]=function(){return a.setTab(b)}};for(d in e)c.routes[d]="_tab_"+d,f(d);return new (Backbone.Router.extend(c))}}).call(this);
